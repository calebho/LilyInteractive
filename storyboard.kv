#:kivy 1.9.1
#:import expanduser os.path.expanduser

<Button, Label, TextInput>:
  font_size: dp(20)

<HomeScreen>:
  BoxLayout:
    orientation: 'vertical'

    Button:
      text: 'Create a new story'
    Button:
      text: 'Edit an existing story'
      on_press: root.manager.current = 'edit'
    Button:
      text: 'Quit'

<FileBrowserPopup>:
  title: 'File system'
  size_hint: .9, .9

  BoxLayout:
    orientation: 'vertical'

    BoxLayout:
      size_hint_y: None
      height: dp(30)

      Button:
        text: 'Icon view'
        on_press: fc.view_mode = 'icon'
      Button:
        text: 'List view'
        on_press: fc.view_mode = 'list'

    FileChooser:
      id: fc
      rootpath: expanduser('~')
      filters: ['*.story']
      FileChooserIconLayout
      FileChooserListLayout

    BoxLayout:
      size_hint_y: None
      height: dp(30)
      
      TextInput:
        id: textbox
        size_hint_x: .8
      Button:
        size_hint_x: .1
        text: 'Save'
        on_press: root.board.save_story(textbox.text + '.story'); root.dismiss()
      Button:
        size_hint_x: .1
        text: 'Cancel'
        on_press: root.dismiss()

<Action>:
  orientation: 'horizontal'
  size_hint_y: None
  height: dp(40)
  padding: map(dp, (5, 5))
  type_button_wid: type_button

  canvas.before:
    Color:
      rgba: 0, 0, 0, 1
    Rectangle:
      size: self.size
      pos: self.pos
  Button:
    id: type_button
    size_hint_x: .2
    text: 'type'
  Label:
    id: parameters
    size_hint_x: .6
  Button:
    text: 'Up'
    size_hint_x: .08
  Button:
    text: 'Down'
    size_hint_x: .12

<AddActionPopup>:
  actions_list_wid: actions_list
  add_action_btn_wid: add_action_button
  title: 'Add actions...'
  size_hint: .4, .9
  
  BoxLayout:
    orientation: 'vertical'
    Button:
      id: add_action_button
      size_hint_y: .1
      text: 'Add an action'
    ScrollView:
      do_scroll_x: False
      size_hint_y: .8
      viewport_size: self.size
      bar_width: dp(10)
      GridLayout:
        id: actions_list
        cols: 1
        spacing: dp(5)
        padding: map(dp, (5, 5))
        size_hint_y: None
        # height: self.height
        orientation: 'vertical'
        # Action
        # Action
    BoxLayout:
      orientation: 'horizontal'
      size_hint_y: .1
      Button:
        text: 'Save'
      Button:
        text: 'Cancel'
    
<AddNodePopup>:
  submit_btn_wid: submit_btn
  node_name: name_field.text
  title: 'Add a story node'
  size_hint: .4, .4
  
  BoxLayout:
    id: form
    orientation: 'vertical'
    
    GridLayout:
      size_hint: 1, 0.8
      pos_hint: {'y': 0.2}
      cols: 2
      row_force_default: True
      row_default_height: dp(40)
      padding: map(dp, (10, 10))
      spacing: map(dp, (0, 10))

      Label:
        text: 'Name'
      TextInput:
        id: name_field
        multiline: False

    GridLayout:
      size_hint: 1, 0.2
      rows: 1
      padding: map(dp, (10, 10))
      spacing: map(dp, (0, 10))
      Button:
        id: submit_btn
        text: 'Submit'
      Button:
        text: 'Cancel'
        on_release: root.dismiss()
  
<EditScreen>:
  dropdown_wid: dropdown
  dropdown_btn_wid: dropdown_btn
  node_info_wid: node_info

  BoxLayout:
    size_hint: 1, 0.075
    pos_hint: {'x': 0, 'y': .925}
    
    Button:
      text: 'Home'
      on_press: root.manager.current = 'home'
    Button:
      text: 'Save'
      on_press: root.check_current_file()
    Button:
      text: 'Save as'
      on_press: root.show_file_chooser()
  
  BoxLayout:
    size_hint: 1, 0.925
    
    BoxLayout:
      size_hint: .3, 1
      orientation: 'vertical'

      Button:
        id: dropdown_btn
        text: '--select a node--'
        size_hint_y: .2
        on_release: dropdown.open(self)

        DropDown:
          id: dropdown
          Button:
            text: 'Add node...'
            size_hint_y: None
            height: dp(30)
            on_release: root.show_add_popup(self)
          
      GridLayout:
        id: node_info
        size_hint_y: .8
        cols: 2
        row_default_height: dp(40)
        row_force_default: True
     
    Image:
      id: storyboard
      texture: root.test_image().texture
      allow_stretch: True

