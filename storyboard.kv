#:kivy 1.9.1
#:import expanduser os.path.expanduser

<Button, Label, TextInput>:
  font_size: dp(20)

<AddNodePopup>:
  title: 'Add a story node'
  size_hint: .4, .4
  
  BoxLayout:
    id: form
    orientation: 'vertical'
    
    GridLayout:
      size_hint: 1, 0.8
      pos_hint: {'y': 0.2}
      cols: 2
      row_force_default: True
      row_default_height: dp(40)
      padding: map(dp, (10, 10))
      spacing: map(dp, (0, 10))

      Label:
        text: 'Name'
      TextInput:
        multiline: False
        on_text: root.fields['name'] = self.text

    GridLayout:
      size_hint: 1, 0.2
      rows: 1
      padding: map(dp, (10, 10))
      spacing: map(dp, (0, 10))
      Button:
        text: 'Submit'
        on_release: root.board.add_node(**root.fields); root.dismiss()
      Button:
        text: 'Cancel'
        on_release: root.dismiss()
  
<EditNodeForm>:
  id: form
  orientation: 'vertical'
  
  GridLayout:
    size_hint: 1, 0.8
    pos_hint: {'y': 0.2}
    cols: 2
    row_force_default: True
    row_default_height: dp(40)
    padding: map(dp, (10, 10))
    spacing: map(dp, (0, 10))

    Label:
      text: 'Name'
    TextInput:
      multiline: False
      on_text: form.fields['name'] = self.text

  GridLayout:
    size_hint: 1, 0.2
    rows: 1
    padding: map(dp, (10, 10))
    spacing: map(dp, (0, 10))
    Button:
      text: 'Submit'
      on_release: form.board.edit_node(**form.fields); form.popup.dismiss()
    Button:
      text: 'Cancel'
      on_release: form.popup.dismiss()
  
<BubbleButton>:
  font_size: dp(16)
  size_hint: None, None
  text_size: None, None
  size: map(dp, self.texture_size)
  halign: 'center'
  # valign: 'middle'
  padding_y: dp(5)

<AddMenu>:
  id: menu
  size_hint: 0, 0
  size: add.size
  
  AddMenuButton:
    id: add
    text: 'Add node'

<EditMenu>:
  size_hint: 0, 0
  size: edit.width + delete.width, edit.height

  EditMenuButton:
    id: edit
    text: 'Edit...'
  DeleteButton:
    id: delete
    text: 'Delete'

<StoryLabel>:
  canvas.before:
    Color:
      rgba: 0, 0, 0, 1
    Rectangle:
      size: self.size
  
  size: self.parent.size
  color: 1, 1, 1, 1
  # text: 'text'

<StoryNode>:
  size_hint: 0, 0
  size: label.texture_size
  StoryLabel:
    id: label

<HomeScreen>:
  BoxLayout:
    orientation: 'vertical'

    Button:
      text: 'Create a new story'
    Button:
      text: 'Edit an existing story'
      on_press: root.manager.current = 'edit'
    Button:
      text: 'Quit'

<FileBrowserPopup>:
  title: 'File system'
  size_hint: .9, .9

  BoxLayout:
    orientation: 'vertical'

    BoxLayout:
      size_hint_y: None
      height: dp(30)

      Button:
        text: 'Icon view'
        on_press: fc.view_mode = 'icon'
      Button:
        text: 'List view'
        on_press: fc.view_mode = 'list'

    FileChooser:
      id: fc
      rootpath: expanduser('~')
      filters: ['*.story']
      FileChooserIconLayout
      FileChooserListLayout

    BoxLayout:
      size_hint_y: None
      height: dp(30)
      
      TextInput:
        id: textbox
        size_hint_x: .8
      Button:
        size_hint_x: .1
        text: 'Save'
        on_press: root.board.save_story(textbox.text + '.story'); root.dismiss()
      Button:
        size_hint_x: .1
        text: 'Cancel'
        on_press: root.dismiss()


<EditScreen>:
  id: screen
  BoxLayout:
    size_hint: 1, 0.075
    pos_hint: {'x': 0, 'y': .925}
    
    Button:
      text: 'Home'
      on_press: root.manager.current = 'home'
    Button:
      text: 'Save'
      on_press: screen.check_current_file()
    Button:
      text: 'Save as'
      on_press: screen.show_file_chooser()
  
  Board:
    id: board
    size_hint: 1, 0.925
    
    canvas.before:
      Rectangle:
        size: self.size

